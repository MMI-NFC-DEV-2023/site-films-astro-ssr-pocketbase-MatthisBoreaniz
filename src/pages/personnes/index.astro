---
import { Debug } from "astro:components";
import Layout from "../../layouts/Layout.astro";
import type {
  FilmsResponse,
  PersonnesResponse,
  RolesResponse,
} from "../../pocketbase-typegen";
export const prerender = false;

const listPersonnes = await Astro.locals.pb
  .collection<
    PersonnesResponse<{
      films_via_producteur?: FilmsResponse[];
      films_via_scenaristes?: FilmsResponse[];
      roles_via_acteur?: RolesResponse[];
    }>
  >("personnes")
  .getFullList({
    expand: "films_via_producteur, films_via_scenaristes, roles_via_acteur",
  });
---

<!-- <pre>
    {JSON.stringify(listPersonnes, null, 2)}
</pre> -->
<Layout pageTitle="Liste des personnes">
  {
    listPersonnes.map((personne) => (
      <div>
        <h2>Personne : {personne.nom}</h2>

        {personne.expand?.roles_via_acteur && (
          <p>
            Les roles : :{" "}
            {personne.expand?.roles_via_acteur.map((f) => (
              <span>{f.nomRole + ", " + "Joué par :"  + personne.nom + ", "}</span>
            ))}
          </p>
        )}

        {personne.expand?.films_via_producteur && (
          <p>
            Les films où il est producteur :{" "}
            {personne.expand?.films_via_producteur.map((f) => (
              <span>{f.titre + ", "}</span>
            ))}
          </p>
        )}
        {personne.expand?.films_via_scenaristes && (
          <p>
            Les films où il est scenariste :{" "}
            {personne.expand?.films_via_scenaristes.map((f) => (
              <span>{f.titre + ", "}</span>
            ))}
          </p>
        )}
      </div>
    ))
  }

  <Debug {listPersonnes} />
</Layout>
