---
import { Debug } from "astro:components";
import Layout from "../../layouts/Layout.astro";
import type { FilmsResponse, PersonnesResponse, RolesResponse } from "../../pocketbase-typegen";
export const prerender = false
type Response = FilmsResponse<{
    producteur?: PersonnesResponse;
    scenaristes?: PersonnesResponse[];
    role?: RolesResponse<{acteur: PersonnesResponse}>[];
}>;

const listFilms = await Astro.locals.pb.collection<Response>("films")
    .getFullList({expand:"producteur, scenaristes, role.acteur"});

---
<!-- <pre>
    {JSON.stringify(listPersonnes, null, 2)}
</pre> -->

<Layout pageTitle="Liste des personnes">
    {listFilms.map(film => <div>
        <h2>Film : {film.titre}</h2>
        <p>Année de sortie : {film.dateSortie}</p>
        {  film.expand?.producteur &&      <p>Producteur : {film.expand?.producteur.nom}</p>}        
        {film.expand?.scenaristes && <p>Scénaristes : {film.expand?.scenaristes.map(s => (<span>{s.nom + ", "}</span>))}</p>}
        <p>Durée : {film.duree} minutes</p>
        { film.expand?.role &&  <p>Les roles : 
            {film.expand?.role.map(r => 
            <span>Nom du role : {r.nomRole + ", "}</span> 
            <span>Joué par : {r.expand?.acteur.nom +", "}</span>)}</p>
        }
    </div>)}
    <Debug {listFilms} />
</Layout>